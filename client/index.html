
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>Genome Browser Visualization</title>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!--=========================  CSS  =========================-->
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="css/libs/bootstrap.min.css">
    <link rel="stylesheet" href="css/libs/normalize.css">
    <link rel="stylesheet" href="css/libs/main.css">

    <link rel="stylesheet" href="css/d3_styles.css">
    <!--=========================================================-->

    <!--=========================  JS  ==========================-->
    <script src="js/libs/modernizr-2.8.3.min.js"></script>
    <script src="js/libs/jquery-1.11.3.min.js"></script>
    <script src="js/libs/d3-3.5.6.min.js"></script>
    <script src="js/libs/d3-tip-0.6.7.js"></script>
    <!--script src="js/libs/md5.js"></script-->

    <script src="js/main.js"></script>
    <script src="js/server.js"></script>
    <script src="js/draw.js"></script>
    <!--=========================================================-->
</head>

<body>
    <!--[if lt IE 7]>
    <p class="browsehappy">
        You are using an <strong>outdated</strong> browser. Please
        <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.
    </p>
    <![endif]-->


    <!-- START VIEW -->
    <div class="container start-view">
        <div class="row">
            <div class="col-md-4 col-md-offset-4">
                <div class="panel panel-default login-panel">
                    <div class="panel-heading">
                        <h3 class="panel-title">Please Sign In</h3>
                    </div>
                    <div class="panel-body">
                        <form role="form">
                            <fieldset>
                                <div class="form-group">
                                    <input class="form-control" id="username" placeholder="Username" name="username" autofocus>
                                </div>
                                <div class="form-group">
                                    <input class="form-control" id="password" placeholder="Password" name="password" type="password" value="">
                                </div>
                                <a href="#" id="btLogin" class="btn btn-lg btn-success btn-block">Login</a>
                            </fieldset>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- CORE VIEW -->
    <div class="core-view" style="display:none;">

        <div style="float:left;">

            <!-- FILE UPLOAD -->
            <div style="margin-top:5px;">

                <div style="float:left;margin-left: 30px;margin-right:5px;">
                    <input type="file" id="files" name="files[]" multiple style="float:left" title="Select any .wig file"/>
                    <!--output id="list"></output-->
                    <script src="js/upload-file.js"></script>
                </div>

                <div style="    float:left;margin-left:5px;margin-right:5px;">
                    <input type="checkbox" id="reload" title="Check if you want to recompute bins instead of using the previouly computed ones, if available.">Reload<br>
                </div>

                <!--<div style="float:left;margin-left:5px;margin-right:5px;">
                    <button type="button" style="float:left" onclick="destroyAll(true)">Delete</button>
                </div>-->

                <!-- ICON OF "LOADING..." -->
                <div style="float:left;margin-left:5px;">
                    <img id="imgLoadingFile" src="images/loading.gif" style="visibility:hidden"/>
                </div>

            </div>


            <!-- SEARCH -->
            <div>

                <!--div style="float:left;margin-top:4px;margin-left:30px;margin-right:20px;">
                    <button type="button"id="btConfigParams">Params</button>
                </div-->

                <div style="float:left;margin-top:4px;margin-left:30px;margin-right:5px;">
                    <input type="text" id="patternSearch" title="pattern to search, according to the window and number of bins. You can also search for intervals with 'start-end' and by gene names">
                </div>

                <div style="float:left;margin-top:4px;margin-left:5px;margin-right:5px;">
                    <select id="dSearch" title="# of permitted 'point mutations' from the original pattern">
                        <option value="0" selected="selected">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </div>

                <div style="float:left;margin-left:5px;margin-right:5px;margin-top:4px">
                    <input type="button" id="showSearchOptions" value="Options" title="Search options" class="options"><br>
                </div>

                <div style="float:left;margin-top:4px;margin-left:5px;margin-right:5px;">
                    <button type="button" onclick="searchPattern()">Search</button>
                </div>

                <!-- ICON OF "LOADING..." -->
                <div style="float:left;margin-top:4px;margin-left:5px;">
                    <img id="imgLoadingSearch" src="images/loading.gif" style="visibility:hidden"/>
                </div>

            </div>
        </div>

        <!-- CHROMOSOME ICONS -->
        <div style="float:left;margin-left:25px;" id="imagesChromosomes"></div>

        <!-- LOGOUT -->
        <div style="float:right;margin-left:10px;margin-right:100px;margin-top:5px;">
            <button type="button" id="btLogout">Logout</button>
        </div>


        <!-- VISUALIZATION -->
        <div id="lineSeq"></div>
        <div id="lineSeq2"></div>
        <div id="lineSeq3"></div>

    </div>


    <!-- Modal -->
    <div class="modal fade" id="modalConfigParams" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal: header -->
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h3 class="modal-title">Modify parameters of preprocess</h3>
                </div>

                <!-- Modal: body -->
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-7 col-sm-offset-1">
                            <label class="control-label" for="paramWS" title="Number of positions to use for each bin. E.g. with a size of 30, each letter correspond to the percentile interval corresponding to the average level of 30 nucleotides">Window size</label>
                        </div>
                        <div class="col-sm-2">
                            <input class="form-control" type="text" id="paramWS">
                        </div>
                    </div>
                    <div class="row" style="padding-top:10px;">
                        <div class="col-sm-7 col-sm-offset-1">
                            <label class="control-label" for="paramNB" title="Number of percentile bins into which the quantitative levels will be divided. E .g. 5 bins will use percentiles 0,20,40,60,80,100 to set bins a,b,c,d,e respectively">Number of bins</label>
                        </div>
                        <div class="col-sm-2">
                            <input class="form-control" type="text" id="paramNB">
                        </div>
                    </div>
                   <!-- <div class="row" style="padding-top:10px;">
                        <div class="col-sm-7 col-sm-offset-1">
                            <label class="control-label" for="paramMaxSize">Maximum number of normalized data</label>
                        </div>
                        <div class="col-sm-3">
                            <input class="form-control" type="text" id="paramMaxSize">
                        </div>
                    </div>-->
                </div>

                <!-- Modal: footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" id="btConfigParamsSave" class="btn btn-primary">Save changes</button>
                </div>

            </div>
        </div>
    </div>




    <!-- Modal -->
    <div class="modal fade" id="searchOptions" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal: header -->
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h3 class="modal-title">Search options</h3>
                </div>

                <!-- Modal: body -->
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-3 col-sm-offset-1">
                        <label title="Draw the binning areas for the underlying discretization"><input type="checkbox" id="paramGrid">Draw Grid<br></label>
                    </div>
                    <div class="col-sm-3">
                        <label title="Soft mutations consider only 1-letter distance mutations, in the case that parameter d>0"><input type="checkbox" id="paramMutations" checked>Soft mutations<br></label>
                    </div>
                    <!--<div class="col-sm-3">
                        <label title="Annotations are considered only if they partially/totally include a pattern-matched area"><input type="checkbox" id="paramIntersect">Hard intersect<br></label>
                    </div>-->
                    </div>

                    <div class="row">
                        <div class="col-sm-3 col-sm-offset-1">
                            <label title="If checked, only searches coincident with the corresponding genomic annotations will be considered"><input type="checkbox" id="paramGeo" >Restriction to:<br></label>
                        </div>
                        <div class="col-sm-3">
                            <select id="geo_type">
                                <option value="gene">Genes</option>
                                <option value="exon">Exons</option>
                                <option value="five_prime_UTR">5' UTRs</option>
                                <option value="three_prime_UTR">3' UTRs</option>
                                <option value="RNA_gene">RNA genes</option>
                                <option value="intergenic">Intergenic regions</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Modal: footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="btConfigSearchSave" class="btn btn-primary">Save</button>
                </div>

            </div>
        </div>
    </div>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!--script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script-->
    <script src="js/libs/bootstrap.min.js"></script>



    <script>

        // This part of the code is executed automatically when the page is ready
        $(window).ready(function()
        {
            // CHANGE PARAMS (WITH RELOAD)
            ////////////////////////////////////////////
            reloadParams(false);

            $('#reload').change(function()
            {
                if($(this).is(":checked"))
                {
                    reloadParams(false);
                    $('#modalConfigParams').modal();
                }
            });

            $('#btConfigSearchSave').click(function()
            {
                GVB_GLOBAL.geo       = paramGeo.checked;
                GVB_GLOBAL.grid  = paramGrid.checked;
                if(paramMutations.checked)
                    GVB_GLOBAL.softMutations  = "true";
                else
                    GVB_GLOBAL.softMutations  = "false";

                $('#searchOptions').modal('hide');

                drawGrid();
            });

            $('#btConfigParamsSave').click(function()
            {
                reloadParams(true);
            });

            function reloadParams(saveParams)
            {
                var IParamWS        = $('#paramWS');
                var IParamNB        = $('#paramNB');
                //var IParamMaxSize   = $('#paramMaxSize');


                if(saveParams)
                {
                    GVB_GLOBAL.ws       = IParamWS.val();
                    GVB_GLOBAL.nb       = IParamNB.val();
//                    GVB_GLOBAL.maxSize  = IParamMaxSize.val();
                }

                IParamWS.val(GVB_GLOBAL.ws);
                IParamNB.val(GVB_GLOBAL.nb);
               // IParamMaxSize.val(GVB_GLOBAL.maxSize);

                $('#modalConfigParams').modal('hide');
            }

            // CHANGE SEARCH PARAMS
            /////////////////////////////////////////////
            $('#showSearchOptions').click(function()
            {
                $('#searchOptions').modal();
            });



            // LOGIN and LOGOUT
            ////////////////////////////////////////////
            $('#btLogin').click(function()
            {
                var username = $('#username').val();
                var password = $('#password').val();


                //Server.connect(true, verifyConnection, username, password, "http://prodiasv21.fis.usal.es:2750/");
                Server.connect(true, verifyConnection, username, password, "http://127.0.0.1:2750/");

                return false;
            });

            $('body').css("background-color", "#f8f8f8");
            function verifyConnection(done)
            {
                if(done)
                {
                    $('.start-view').hide();
                    $('.core-view').show();

                    $('body').css("background-color", "#ffffff");
                }
                else
                {
                    alert("The user or password is incorrect");
                }
            }

            $('#btLogout').click(function()
            {
                $('body').css("background-color", "#f8f8f8");

                $('.core-view').hide();
                $('.start-view').show();
                destroyAll(true);

                return false;
            });


            // TESTING (TODO: only testing, remove this)
            ////////////////////////////////////////////////
                //$('#patternSearch').val("aaaaabcba");
                //$('#patternSearch').val("a*5+abcba*2");
                $('#patternSearch').val("a*5+abcba"); // esta es la buena con enrichment
                $('#username').val("jpiriz");
                $('#password').val("alguna");
                $('#btLogin').click();
            ////////////////////////////////////////////////

        });
    </script>
</body>
</html>
